{"version":3,"file":"chats.jsx","sourceRoot":"","sources":["../../../src/pages/chats.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Fragment, useCallback, useEffect, useState } from 'react'\nimport { Row, Text } from '@nextui-org/react'\nimport { useRouter } from 'next/router'\nimport { FiPlus } from 'react-icons/fi'\nimport { useSnapshot } from 'valtio'\n\nimport ChatSummaryCard from '@/components/ChatSummaryCard'\nimport PageHeader from '@/components/PageHeader'\nimport ChatRequestsButton from '@/components/ChatRequestsButton'\nimport { chatClient } from '@/utils/WalletConnectUtil'\nimport ChatPrimaryCTAButton from '@/components/ChatPrimaryCTAButton'\nimport SettingsStore from '@/store/SettingsStore'\nimport { Web3Modal } from '@web3modal/standalone'\nimport { HiQrcode } from 'react-icons/hi'\n\nconst web3modal = new Web3Modal({\n  projectId: process.env.NEXT_PUBLIC_PROJECT_ID || '',\n  walletConnectVersion: 1\n})\n\nexport default function ChatsPage() {\n  const router = useRouter()\n  const [isLoading, setIsLoading] = useState(true)\n\n  const [chatThreads, setChatThreads] = useState<\n    { topic: string; selfAccount: string; peerAccount: string }[]\n  >([])\n\n  const [chatInvites, setChatInvites] = useState<any[]>([])\n  const { eip155Address } = useSnapshot(SettingsStore.state)\n\n  const inviteQrCode = useCallback(async () => {\n    const idx = SettingsStore.state.account === 0 ? 1 : 0\n    const uri = `${window.location.origin}/newChat?accountIndex=${idx}&target=eip155:1:${SettingsStore.state.eip155Address}`\n\n    web3modal.openModal({ uri })\n  }, [])\n\n  const initChatClient = async () => {\n    console.log(chatClient)\n\n    console.log(\n      'chatInvites on load:',\n      chatClient.chatReceivedInvites.getAll({ inviteeAccount: eip155Address })\n    )\n    console.log('chatThreads on load:', chatClient.chatThreads.getAll())\n    console.log('chatMessages on load:', chatClient.chatMessages.getAll())\n    setChatThreads(chatClient.chatThreads.getAll())\n    setChatInvites(chatClient.getReceivedInvites({ account: `eip155:1:${eip155Address}` }))\n\n    chatClient.on('chat_invite', async args => {\n      console.log('chat_invite:', args)\n      web3modal.closeModal()\n      setChatInvites(chatClient.getReceivedInvites({ account: `eip155:1:${eip155Address}` }))\n    })\n\n    chatClient.on('chat_invite_accepted', async args => {\n      console.log('chat_joined:', args)\n      console.log(chatClient.chatThreads.getAll())\n      setChatThreads(chatClient.chatThreads.getAll())\n    })\n\n    setIsLoading(false)\n  }\n\n  useEffect(() => {\n    initChatClient()\n  }, [])\n\n  console.log({ chatInvitesLength: chatInvites.length })\n\n  return (\n    <Fragment>\n      <PageHeader\n        title=\"Chat\"\n        ctaButton={\n          <Row justify=\"space-evenly\">\n            <ChatPrimaryCTAButton icon={<HiQrcode />} onClick={inviteQrCode} />\n            <ChatPrimaryCTAButton icon={<FiPlus />} onClick={() => router.push('/newChat')} />\n          </Row>\n        }\n      />\n\n      <Row justify=\"center\" align=\"center\" css={{ paddingBottom: '$5' }}>\n        {chatInvites.length ? <ChatRequestsButton requestCount={chatInvites.length} /> : null}\n        {/* <ChatRequestsButton requestCount={chatInvites.length} /> */}\n      </Row>\n\n      {isLoading ? (\n        <Text css={{ opacity: '0.5', textAlign: 'center', marginTop: '$20' }}>\n          Fetching chats...\n        </Text>\n      ) : chatThreads.length ? (\n        chatThreads.map(props => {\n          return <ChatSummaryCard key={props.topic} {...props} />\n        })\n      ) : (\n        <Text css={{ opacity: '0.5', textAlign: 'center', marginTop: '$20' }}>No chats</Text>\n      )}\n    </Fragment>\n  )\n}\n"]}